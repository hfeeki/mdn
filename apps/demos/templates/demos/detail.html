{% extends "demos/base.html" %}

{% block pageid %}{% endblock %}
{% block bodyclass %}section-demos{% endblock %}
{% block title %}{{ page_title(_('{subtitle} | Demo Studio') | f(subtitle=submission.title)) }}{% endblock %}

{% block content %}
<section id="nav-toolbar">
<div class="wrap">
  <nav class="crumbs">
    <ol role="navigation">
      <li><a href="{{ url('home') }}">MDN</a></li>
      <li><a href="{{ url('demos') }}">Demo Studio</a></li>
      <li><a href="{{ submission.get_absolute_url() }}">{{submission.title}}</a></li>
    </ol>
  </nav>
  
  {% if False %}{# Enable when we have lateral navigation #}
  <nav class="paging">
    <ul role="navigation">
      <li class="prev"><a href="#" title="Go to the previous demo, &ldquo;Demo Title&rdquo;">Prev</a></li>
      <li class="next"><a href="#" title="Go to the next demo, &ldquo;Demo Title&rdquo;">Next</a></li>
    </ul>
  </nav>
  {% else %}
  <p class="demo-submit"><a href="{{ url('demos_submit') }}" class="button">Submit a Demo</a></p>
  {% endif %}

</div>
</section>

<section id="content">
<div class="wrap">

  <section id="content-main" role="main" class="full">
  
    <section id="demobox">
      <h1 class="page-title">{{submission.title}}</h1>
      <p class="byline">by {{ submission_creator(submission) }} 
        on <time datetime="">{{ submission.created }}</time></p>

      <!-- only shown to admins and the demo owner -->
      <ul class="manage">

        {% if submission.allows_editing_by(request.user) %}
            <li><a href="{{ url('demos_edit', slug=submission.slug) }}" 
                class="button edit">{{_('Edit Demo')}}</a></li>
        {% endif %}

        {% if submission.allows_deletion_by(request.user) %}
            <li><form id="demo-remove" method="post" action="{{ url('demos_delete', slug=submission.slug) }}">{{ csrf() }}<button type="submit" class="remove"><span>{{_("Remove demo")}}</span></button></form></li>
        {% endif %}
        {% if submission.allows_hiding_by(request.user) %}
            {% if submission.hidden %}
                <li><form id="demo-remove" method="post" action="{{ url('demos_show', slug=submission.slug) }}">{{ csrf() }}<button type="submit" class="remove"><span>{{_("Show demo")}}</span></button></form></li>
            {% else %}
                <li><form id="demo-remove" method="post" action="{{ url('demos_hide', slug=submission.slug) }}">{{ csrf() }}<button type="submit" class="remove"><span>{{_("Hide demo")}}</span></button></form></li>
            {% endif %}
        {% endif %}

      </ul>

      <div class="demo-desc">
        <p>{{ submission.summary }}</p>
      </div>

      <ul class="tools">

        <li><a href="{{ url('demos_launch', slug=submission.slug) }}" class="button launch"><strong>Launch Demo</strong></a></li>

        <li>
            {% set likes = submission.likes.get_total_for_request(request) %}
            {% if likes > 0 %}
              <form id="demo-like" method="post" action="{{ url('demos_unlike', slug=submission.slug) }}">
                {{ csrf() }}
                <button type="submit" class="unlike" title="You like this demo. Undo?"><span>{{_('You Like')}}</button>
              </form>
            {% else %}
              <form id="demo-like" method="post" action="{{ url('demos_like', slug=submission.slug) }}">
                {{ csrf() }}
                <button type="submit" class="like" title="Do you like this demo?"><span>{{_('Like It')}}</button>
              </form>
            {% endif %}
        </li>

        <li class="share"><a href="#share-opts" id="sharetoggle" title="Share this demo with your social network">Share It</a>
          <ul id="share-opts">
            {% set full_url = request.build_absolute_uri(submission.get_absolute_url()) %}
            {% set short_url = full_url | bitly_shorten %}
            <li class="sharetitle">Share It</li>
            <li class="twitter"><a href="http://twitter.com/share?{{ urlencode({"url":short_url, "text":submission.title, "via":"mozhacks"}) }}">Share on Twitter</a></li>
            <li class="facebook"><a href="http://www.facebook.com/sharer.php?{{ urlencode({"u":short_url, "t":submission.title}) }}">Share on Facebook</a></li>
            <li class="link"><input id="shorturl" type="text" readonly="readonly" value="{{ short_url }}"></li>
          </ul>
          <script type="text/javascript">
              var so = document.getElementById('share-opts');
              so.className = 'js';
              so.style.display = 'none';
            </script>
        </li>
      </ul>

      <div class="demo-meta">
        <p class="tags">Built using 
            {% for tag in tags_for_object(submission) %}
                <a title="See more demos made with {{ tag_title(tag) }}" href="{{ url('demos_tag', tag=tag.name) }}">{{ tag_title(tag) }}</a>{% if not loop.last %}, {% endif %}
            {% endfor %}
        </p>

        <ul class="stats">
            {% set launches = submission.launches.total %}
            {% set likes = submission.likes.total %}
            {% set comments = submission.comments_total %}
            <li class="views" title="{{ ngettext('This demo has been viewed {count} time', 'This demo has been viewed {count} times', launches) | f(count=launches) }}">{{ngettext('{count} view', '{count} views', launches) | f(count=launches) }}</li>
            <li class="likes" title="{{ ngettext('{count} person liked this demo', '{count} people liked this demo', likes) | f(count=likes) }}">{{ngettext('{count} like', '{count} likes', likes) | f(count=likes) }}</li>
            <li class="comments" title="{{ ngettext('There is {count} comment for this demo', 'There are {count} comments for this demo', comments) | f(count=comments) }}">{{ _('{comment_count} comments') | f(comment_count=comments) }}</li>
        </ul>
      </div>
      
  		<div class="screenshots">
    		<ul class="nav-screens">
              <li class="nav-prev"><a href="#" class="prev" title="See the previous image">Previous</a></li>
      		  <li class="nav-next"><a href="#" class="next" title="See the next image">Next</a></li>
            </ul>
  		  
    		<ul class="slider">
              {% for idx in range(1, 6) %}
                  {% if submission['screenshot_'~idx] %}
                    <li class="panel">
                      <img src="{{ submission['screenshot_'~idx].url }}" alt="" width="480" height="360">
                    </li>
                  {% endif %}
              {% endfor %}
            </ul>

  		</div><!-- /.screenshots -->
        <script type="text/javascript">
            var els = document.getElementsByTagName('div');
            for (var i=0,el; el=els[i]; i++) {
                if (el.className == 'screenshots') { 
                    el.className += ' js'; 
                    el.parentNode.style.overflow = 'hidden';
                }
            }
        </script>

    </section><!-- /#demobox -->
    
    <section class="demo-more">

      <section class="moreabout">
        <h1>{{_('More About This Demo')}}</h1>
        <p>{{ submission.description | nl2br }}</p>
      </section>   
      
      <section id="comments">
        <header>
          {% if submission.comments_total == 0 %}
              <h1>{{_('No comments yet.')}}</h1>
          {% else %}
              <h1>{{ submission.comments_total }} comments so far</h1>
          {% endif %}
          {% if request.user.is_authenticated() %}
              <p>Why not <a href="#comment-post">Add your own</a>?</p>
          {% else %}
              <p><a href="/register/">Register</a> or <a href="/login/">log in</a> to add your own.</p>
          {% endif %}
        </header>

        <div class="comments">
            {% set tree = get_threaded_comment_tree(submission) %}
            {% for comment in tree %}
                <div id="comment-{{ comment.id }}" style="border: 1px #ddd dotted; margin: 1em; padding: 1em; margin-left: {{ comment.depth * 2 }}em;" class="comment comment-level-{{ comment.depth }}">
                    <a href="#">{{ comment.user.username }}</a> said @ <a href="#comment-{{ comment.id }}">{{ comment.date_submitted }}</a>:<br/>
                    {# TODO: Uncomment this to allow markup choices #}
                    {# auto_transform_markup(comment) #}
                    {{ comment.comment | nl2br }}

                    {% if request.user.is_authenticated() %}
                        <div class="comment_reply">
                            <a href="#" class="show_reply">{{_('Reply')}}</a>
                            <form method="POST" action="{{ get_comment_url(submission, comment) }}">
                                {{ csrf() }}
                                <textarea rows="10" cols="40" name="comment"></textarea><br/>
                                <input type="submit" value="Comment" />
                            </form>
                        </div>
                    {% endif %}

                </div>
            {% endfor %}
        </div>
        
        {% if False %}
        <ol id="comments-list" class="hfeed">
        	<li class="hentry" id="comment-123"><!-- every comment should have a unique ID for permalinking, however that ID is assigned (just sequential numbering I presume?) Remember that values of ID attributes in HTML cannot begin with a numeral -->
            <p class="entry-title vcard"><cite class="author fn"><a href="#" class="url" title="See Naomi Bellering's profile"><img class="photo" src="{{MEDIA_URL}}img/blank.gif" alt="" width="48" height="48"> Naomi Bellering</a></cite> said,</p><!-- Avatar has empty alt -->
        		<p class="entry-meta">Posted <a href="#comment-123" rel="bookmark" title="Permanent link to this comment by Naomi Bellering"><time class="published" pubdate="pubdate" datetime="2010-12-31T18:48:02-08:00" title="2010-12-31">Dec 31, 2010</time></a></p>
        		<!-- NOTES: 
        		     See http://microformats.org/wiki/hatom for more on the hatom microformat. 
                 Published dates should be in the Y-m-d format in the title, following the microformat date pattern (less verbose than the datetime pattern but lesser impact on accessibility).
                 The datetime value can be the same as the title, or more verbose if we want to get really OCD about it: 'Y-m-d\TH:i:sP'
            -->
        		<blockquote class="entry-content">
        			<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros.</p>
        			<p>Nullam malesuada erat ut turpis. Suspendisse urna nibh, viverra non, semper suscipit, posuere a, pede.</p>
        		</blockquote>
        		
        		<ul class="comment-opts"><!-- only for logged-in users -->
        		  <li class="opt-reply"><a href="#comment-post" title="Reply to this comment by Naomi Bellering">Reply</a></li>
        		  <li class="opt-report"><a href="/report/confirm" title="Report this comment">Report</a></li><!-- Do you have to be logged in to report a comment? -->
        		  <li class="opt-delete"><a href="#" title="Edit this comment">Edit</a></li><!-- shown only to demo owner and admins... can users edit their own comments? -->
        		  <li class="opt-delete"><a href="/delete/confirm" title="Delete this comment">Delete</a></li><!-- shown only to demo owner and admins... can users delete their own comments? -->
        		</ul>
        	</li>
          
          <li class="hentry alt" id="comment-456">
        	  <p class="entry-title vcard"><cite class="author fn"><a href="#" class="url" title="See Byron Orpheus' profile"><img class="photo" src="./img/blank.gif" alt="" width="48" height="48"> Byron Orpheus</a></cite> said,</p>
        		<p class="entry-meta">Posted <a href="#comment-456" rel="bookmark" title="Permanent link to this comment by Byron Orpheus"><time class="published" datetime="" title="2011-01-05">5 days ago</time></a></p>
        		<blockquote class="entry-content">
        			<p>Phasellus ultrices nulla quis nibh. Quisque a lectus. Donec consectetuer ligula vulputate sem tristique cursus. Nam nulla quam, gravida non, commodo a, sodales sit amet, nisi.</p>
              <p>Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</p>
        		</blockquote>
        		<ul class="comment-opts"><!-- only for logged-in users -->
        		  <li class="opt-reply"><a href="#comment-post" title="Reply to this comment by Naomi Bellering">Reply</a></li>
        		  <li class="opt-report"><a href="/report/confirm" title="Report this comment">Report</a></li>
        		  <li class="opt-delete"><a href="#" title="Edit this comment">Edit</a></li>
        		  <li class="opt-delete"><a href="/delete/confirm" title="Delete this comment">Delete</a></li>
        		</ul>

        		<ol class="replies">
              <li class="hentry" id="comment-342">
                <!-- If the commenter's account has been deleted, the name shouldn't be linked (no profile to link to) and the avatar is replaced with the generic. The comment remains for posterity. -->
            	  <p class="entry-title vcard"><cite class="author fn"><img class="photo" src="./img/blank.gif" alt="" width="48" height="48"> Deleted Member</cite> said,</p>
            		<p class="entry-meta">Posted <a href="#comment-342" rel="bookmark" title="Permanent link to this comment"><time class="published" datetime="" title="2011-01-10">8 hours ago</time></a></p>
            		<blockquote class="entry-content">
            			<p>Suspendisse mauris. Fusce accumsan mollis eros. Pellentesque a diam sit amet mi ullamcorper vehicula. Integer adipiscing risus a sem. Nullam quis massa sit amet nibh viverra malesuada. Nunc sem lacus, accumsan quis, faucibus non, congue vel, arcu. Ut scelerisque hendrerit tellus. Integer sagittis. Vivamus a mauris eget arcu gravida tristique. Nunc iaculis mi in ante. Vivamus imperdiet nibh feugiat est.</p>
            		</blockquote>
            		<ul class="comment-opts">
            		  <li class="opt-reply"><a href="#comment-post" title="Reply to this comment by Naomi Bellering">Reply</a></li>
            		  <li class="opt-report"><a href="/report/confirm" title="Report this comment">Report</a></li>
            		  <li class="opt-delete"><a href="#" title="Edit this comment">Edit</a></li>
            		  <li class="opt-delete"><a href="/delete/confirm" title="Delete this comment">Delete</a></li>
            		</ul>

                <ol class="replies">
                  <li class="hentry alt" id="comment-985">
                	  <p class="entry-title vcard"><cite class="author fn"><a href="#" class="url" title="See Byron Orpheus' profile"><img class="photo" src="./img/blank.gif" alt="" width="48" height="48"> Byron Orpheus</a></cite> said,</p><!-- avatar has empty alt -->
                		<p class="entry-meta">Posted <a href="#comment-985" rel="bookmark" title="Permanent link to this comment by Byron Orpheus"><time class="published" datetime="" title="2011-01-10">25 minutes ago</time></a></p>
                		<blockquote class="entry-content">
                			<p>Sed adipiscing ornare risus. Morbi est est, blandit sit amet, sagittis vel, euismod vel, velit. Pellentesque egestas sem. Suspendisse commodo ullamcorper magna.</p>
                		</blockquote>
                		<ul class="comment-opts">
                		  <!-- No Reply option on deep-neested comments, depending on how many levels of replies we want to allow. -->
                		  <li class="opt-report"><a href="/report/confirm" title="Report this comment">Report</a></li>
                		  <li class="opt-delete"><a href="#" title="Edit this comment">Edit</a></li>
                		  <li class="opt-delete"><a href="/delete/confirm" title="Delete this comment">Delete</a></li>
                		</ul>
                	</li>
            		</ol>

            	</li>
        		</ol>

        	</li>
        </ol><!-- /#comment-list -->
        {% endif %}
        
        {% if request.user.is_authenticated() %}
            <!-- form only shown for logged-in users -->
            <form id="comment-post" method="POST" action="{{ get_comment_url(submission) }}">
              {{ csrf() }}
              <fieldset>
                <legend><span>Add your comment</span></legend>
                <div><textarea id="your-comment" name="comment" rows="6" cols="60"></textarea></div>
                <p><button type="submit">Comment</button></p>
              </fieldset>
            </form>
        {% endif %}

      </section>
    </section>
    
    <section id="demo-sub">
      
      <div class="module" id="source">
        <h3 class="mod-title">Get the Source Code</h3>
        <p class="download"><a href="{{ url('demos_download', slug=submission.slug) }}">Download the Source <span class="note">{{ ( submission.demo_package.size / 1024 ) | round(2,'ceil') }} KB &middot; ZIP File</span></a></p>
        {% if submission.source_code_url %}
        <p class="browse"><a href="{{ submission.source_code_url }}">Browse the Source {% if 'github' in submission.source_code_url %}<span class="note">Hosted on GitHub</span>{% endif %}</a></p>
        {% endif %}
        <p class="license">This demo is released under the <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" rel="license">{{ submission.license_name }}</a>.</p>
      </div>
      
      <div class="module" id="moreby">
        <h3 class="mod-title">More by {{ submission_creator(submission) }}</h3>
        <ul class="gallery">
          {% for more_submission in more_by %}
            {% if more_submission.id != submission.id %}
                {% set thumbnail_url = more_submission.screenshot_1.url.replace('screenshot','screenshot_thumb') %}
                <li><a href="{{ more_submission.get_absolute_url() }}"><img src="{{ thumbnail_url }}" alt="" title="{{ more_submission.title }}" width="90" height="68"></a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
      
      <div id="demo-report">
        <h3>Report a Problem</h3>
        <ul>
          <li><a href="#">Demo is not working</a></li>
          <li><a href="#">Demo is inappropriate</a></li>
          <li><a href="#">Demo is not by this author</a></li>
        </ul>
      </div>
      
    </section>

  </section>

</div>
</section>

{% endblock %}

{% block js %}
    {{ super() }}
      <script type="text/javascript">
      $("#share-opts").ready(function(){
      	$("#share-opts").addClass("js").hide();
      	
      	$("#sharetoggle").click(function() {
          $("#share-opts").fadeIn(100);
          return false;
      	});
      	
        $("#share-opts").hover(
          function() {
            $(this).show();
          },
          function() {
            $(this).fadeOut(100);
            $("#sharetoggle").blur();
          }
        );
      	
        $(document).bind('click', function(e) {
          var $clicked = $(e.target);
          if (! $clicked.parents().hasClass("share"))
            $("#share-opts").hide();
        });
        
        $("a, input, textarea, button").bind('focus', function(e) {
          var $focused = $(e.target);
          if (! $focused.parents().hasClass("share"))
            $("#share-opts").hide();
        });
        
        $("#shorturl").focus(function() {
          $(this).select().addClass("focus");
        });
        $("#shorturl").click(function() {
          $(this).select().addClass("focus");
        });
        $("#shorturl").blur(function() {
          $(this).removeClass("focus");
        });
      
      });
      </script>
       <script type="text/javascript" src="{{MEDIA_URL}}js/carousel.js"></script>

        <script type="text/javascript">
        $(".screenshots").ready(function(){
          // Set up the carousel
          $(".screenshots").show().addClass("js").jCarouselLite({
              btnNext: ".nav-next a",
              btnPrev: ".nav-prev a", 
              visible: 1
          });
          
          $(".screenshots").hover(
            function() {
              $(".nav-next a").animate({ right: "0" },{ queue:false });
              $(".nav-prev a").animate({ left: "0" },{ queue:false });
            },
            function() {
              $(".nav-next a").animate({ right: "-60px" },{ queue:false });
              $(".nav-prev a").animate({ left: "-60px" },{ queue:false });    
            }
          );
          
        });
        </script>
{% endblock %}
